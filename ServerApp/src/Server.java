import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetAddress;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.UnknownHostException;

public class Server {

	public static void socket(String[] args) throws UnknownHostException, IOException {
		// TODO Auto-generated method stub
		 //Initialize Sockets
		//Initialize socket
        Socket socket = new Socket(InetAddress.getByName("localhost"), 5000);
        byte[] contents = new byte[10000];
        
        //Initialize the FileOutputStream to the output file's full path.
        FileOutputStream fos = new FileOutputStream("e:\\data2.bin");
        BufferedOutputStream bos = new BufferedOutputStream(fos);
        InputStream is = socket.getInputStream();
        
        //No of bytes read in one read() call
        int bytesRead = 0; 
        
        while((bytesRead=is.read(contents))!=-1)
            bos.write(contents, 0, bytesRead); 
        
        bos.flush(); 
        socket.close(); 
        
        System.out.println("File saved successfully!");
	}
	
	public static void main(String[] args) throws Exception {
        //Initialize Sockets
		System.out.println("Creating Server socket");
        ServerSocket ssock = new ServerSocket(5000);
        System.out.println("Server socket created");
        int i=1;
        boolean running=true;
        while(running) {
	        Socket socket = ssock.accept();
	        System.out.println("Connection accepted");
	        
	        InputStream is = socket.getInputStream();
	        byte[] contents = new byte[10000];
	        
	      //lettura byte tipo file
	        int typeFile = is.read();
	        
	        
	        //Specify the file
	        String filename;
	        if(typeFile == 1) {
	        		System.out.println("File di tipo immagine");
	        		filename = String.format("%d.jpg", i);
	        } else {
	        		System.out.println("File di tipo TESTO");
	        		filename = "log.txt";
	        }
	        FileOutputStream fos = new FileOutputStream(filename);
	        BufferedOutputStream bos = new BufferedOutputStream(fos);
	        
	        
	        
	        
	        System.out.println("Output file opened");
	      //No of bytes read in one read() call
	        int bytesRead = 0; 
	        
	        while((bytesRead=is.read(contents))!=-1)
	            bos.write(contents, 0, bytesRead); 
	        
	        bos.flush(); 
	        bos.close();
	        System.out.println("File received succesfully!");
	        socket.close(); 
	        
	        i++;
        }
        ssock.close();
        System.out.println("Server closed - exiting");
    }
	

}
